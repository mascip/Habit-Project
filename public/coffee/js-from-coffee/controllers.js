// Generated by CoffeeScript 1.6.3
(function() {
  'use strict';
  var Habit, SingleResult, app, app_name,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __slice = [].slice;

  SingleResult = (function() {
    function SingleResult(_arg) {
      this.day = _arg.day, this.dateTime = _arg.dateTime, this.ticked = _arg.ticked, this.streak = _arg.streak;
    }

    return SingleResult;

  })();

  Habit = (function() {
    function Habit(name, prevResults) {
      this.name = name;
      this.clicked = __bind(this.clicked, this);
      this.currentResult = {
        day: moment().startOf('day'),
        dateTime: 0,
        streak: _.first(prevResults).streak,
        ticked: 0
      };
      this.results = _.clone(prevResults);
      this.results.unshift(_.clone(this.currentResult));
      this.daySelected = 0;
    }

    Habit.prototype.ticked = function() {
      return this.selectedResult().ticked;
    };

    Habit.prototype.streak = function() {
      return this.selectedResult().streak;
    };

    Habit.prototype.selectedResult = function() {
      return this.results[this.daySelected];
    };

    Habit.prototype.calcStreak = function(tick, prevStreak) {
      switch (false) {
        case tick !== 0:
          return prevStreak;
        case tick !== 1:
          return this.increaseStreak(prevStreak);
        case tick !== 2:
          return this.decreaseStreak(prevStreak);
      }
    };

    Habit.prototype.firstResult = function() {
      return _.last(this.results);
    };

    Habit.prototype.updateAllStreaks = function() {
      var i, _i, _ref;
      for (i = _i = _ref = this.results.length - 1; _ref <= 1 ? _i <= 1 : _i >= 1; i = _ref <= 1 ? ++_i : --_i) {
        this.results[i - 1].streak = this.calcStreak(this.results[i - 1].ticked, this.results[i].streak);
      }
      return this.firstResult().streak = this.calcStreak(this.firstResult().ticked, 0);
    };

    Habit.prototype.clicked = function() {
      this.selectedResult().ticked = (this.ticked() + 1) % 3;
      return this.updateAllStreaks();
    };

    Habit.prototype.clickPrevDay = function() {
      return this.daySelected++;
    };

    Habit.prototype.doesntExist = function() {
      return this.daySelected >= this.results.length;
    };

    Habit.prototype.increaseStreak = function(prevStk) {
      if (prevStk > 0) {
        return prevStk + 1;
      } else {
        return 1;
      }
    };

    Habit.prototype.decreaseStreak = function(prevStk) {
      if (prevStk < 0) {
        return prevStk - 1;
      } else {
        return -1;
      }
    };

    Habit.prototype.selectPrevDay = function() {};

    Habit.prototype.selectNextDay = function() {};

    return Habit;

  })();

  /* Controllers*/


  app_name = "myApp";

  app = angular.module("" + app_name + ".controllers", []);

  app.controller('myCtrl2', [
    '$scope', function($scope) {
      return $scope.test = 2;
    }
  ]);

  app.controller('CtrlUserBoard', [
    '$scope', function($scope) {
      var createResults, createSingleResult, now, selectedDay;
      now = moment();
      selectedDay = now.startOf('day');
      $scope.displayedDay = selectedDay.valueOf();
      $scope.checkboxImages = ["images/unchecked_checkbox.png", "images/tick-green.png", "images/red-cross.png"];
      createSingleResult = function(daysAgo, tck, strk) {
        return new SingleResult({
          day: moment().subtract('days', daysAgo).startOf('day'),
          dateTime: moment().subtract('days', daysAgo),
          ticked: tck,
          streak: strk
        });
      };
      createResults = function() {
        var results, resultsArgs;
        resultsArgs = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
        return results = _.map(resultsArgs, function(args) {
          return createSingleResult.apply(null, args);
        });
      };
      $scope.habits = [new Habit('meditation', createResults([1, 1, 5], [2, 1, 4], [3, 1, 3], [4, 1, 2], [5, 1, 1])), new Habit('exercise', createResults([1, 1, 10], [2, 1, 9], [3, 1, 8], [4, 1, 7], [5, 1, 6], [6, 1, 5], [7, 1, 4], [8, 1, 3], [9, 2, -1], [10, 2, -2]))];
      return $scope.clickPrevDay = function() {
        var habit, _i, _len, _ref, _results;
        selectedDay.subtract('days', 1);
        $scope.displayedDay = selectedDay.valueOf();
        _ref = $scope.habits;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          habit = _ref[_i];
          _results.push(habit.clickPrevDay());
        }
        return _results;
      };
    }
  ]);

}).call(this);
