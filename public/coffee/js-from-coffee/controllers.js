// Generated by CoffeeScript 1.6.3
(function() {
  'use strict';
  var Habit, SingleResult, app, app_name,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __slice = [].slice;

  SingleResult = (function() {
    function SingleResult(_arg) {
      this.day = _arg.day, this.dateTime = _arg.dateTime, this.ticked = _arg.ticked, this.streak = _arg.streak;
    }

    return SingleResult;

  })();

  Habit = (function() {
    function Habit(name, prevResults) {
      this.name = name;
      this.prevResults = prevResults;
      this.clicked = __bind(this.clicked, this);
      this.selectedResult = {
        day: moment().startOf('day'),
        dateTime: 0,
        streak: _.last(this.prevResults).streak,
        ticked: 0
      };
      this.nextResults = [];
      this.allTicks = [];
      this.updateAllTicks();
    }

    Habit.prototype.noPrevResults = function() {
      return this.prevResults.length === 0;
    };

    Habit.prototype.prevStreak = function() {
      if (this.noPrevResults()) {
        return 0;
      } else {
        return _.last(this.prevResults).streak;
      }
    };

    Habit.prototype.ticked = function() {
      return this.selectedResult.ticked;
    };

    Habit.prototype.updateStreak = function() {
      return this.selectedResult.streak = (function() {
        switch (false) {
          case this.ticked() !== 1:
            return this.increaseStreak();
          case this.ticked() !== 2:
            return this.decreaseStreak();
          default:
            return this.prevStreak();
        }
      }).call(this);
    };

    Habit.prototype.clicked = function() {
      this.selectedResult.ticked = (this.ticked() + 1) % 3;
      this.updateStreak();
      this.updateAllTicks();
      return _.map(this.nextResults, function(res) {
        return res.updateStreak();
      });
    };

    Habit.prototype.updateAllTicks = function() {
      return this.allTicked = _.pluck(this.allResults(), 'ticked');
    };

    Habit.prototype.increaseStreak = function() {
      if (this.prevStreak() > 0) {
        return this.prevStreak() + 1;
      } else {
        return 1;
      }
    };

    Habit.prototype.decreaseStreak = function() {
      if (this.prevStreak() < 0) {
        return this.prevStreak() - 1;
      } else {
        return -1;
      }
    };

    Habit.prototype.selectPrevDay = function() {
      this.nextResults.unshift(this.selectedResult);
      return this.selectedResult = this.prevResults.pop();
    };

    Habit.prototype.selectNextDay = function() {
      this.nextResults.unshift(this.selectedResult);
      return this.selectedResult = this.prevResults.shift();
    };

    Habit.prototype.allResults = function() {
      var allR;
      allR = [this.selectedResult];
      if (this.prevResults.length) {
        allR = this.prevResults.concat(allR);
      }
      if (this.nextResults.length) {
        allR = allR.concat(this.nextResults);
      }
      return allR;
    };

    return Habit;

  })();

  /* Controllers*/


  app_name = "myApp";

  app = angular.module("" + app_name + ".controllers", []);

  app.controller('myCtrl2', [
    '$scope', function($scope) {
      return $scope.test = 2;
    }
  ]);

  app.controller('CtrlUserBoard', [
    '$scope', function($scope) {
      var createResults, createSingleResult, now, selectedDay;
      now = moment();
      selectedDay = now.startOf('day');
      $scope.displayedDay = selectedDay.valueOf();
      $scope.checkboxImages = ["images/unchecked_checkbox.png", "images/tick-green.png", "images/red-cross.png"];
      createSingleResult = function(daysAgo, tck, strk) {
        return new SingleResult({
          day: moment().subtract('days', daysAgo).startOf('day'),
          dateTime: moment().subtract('days', daysAgo),
          ticked: tck,
          streak: strk
        });
      };
      createResults = function() {
        var results, resultsArgs;
        resultsArgs = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
        return results = _.map(resultsArgs, function(args) {
          return createSingleResult.apply(null, args);
        });
      };
      $scope.habits = [new Habit('meditation', createResults([5, 1, 1], [4, 1, 2], [3, 1, 3], [2, 1, 4], [1, 1, 5])), new Habit('exercise', createResults([10, 1, 1], [9, 1, 2], [8, 1, 3], [7, 1, 4], [6, 1, 5], [5, 1, 6], [4, 1, 7], [3, 1, 8], [2, 2, -1], [1, 2, -2]))];
      return $scope.selectPrevDay = function() {
        var habit, _i, _len, _ref, _results;
        selectedDay.subtract('days', 1);
        $scope.displayedDay = selectedDay.valueOf();
        _ref = $scope.habits;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          habit = _ref[_i];
          _results.push(habit.selectPrevDay());
        }
        return _results;
      };
    }
  ]);

}).call(this);
